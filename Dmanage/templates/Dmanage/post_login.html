{% extends "Dmanage/layout.html" %}

{% block title %}
    Disaster Management Map
{% endblock %}

{% block body %}
<h1>Disaster Map</h1>

<!-- Map container where Leaflet will display the map -->
<div id="map" style="height: 600px; width: 100%;"></div>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" crossorigin=""/>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" crossorigin=""></script>

<!-- Safely pass JSON data to JavaScript -->
{{ reports|json_script:"reports_data" }}

<script>
    // Initialize the map
    var map = L.map('map').setView([20.5937, 78.9629], 5);  // Center on India, zoom level 5

    // Load OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    // Fetch reports data from the template
    var reports = JSON.parse(document.getElementById('reports_data').textContent);

    // Check if reports data is available
    console.log(reports);

    // Loop over the reports and add markers
    reports.forEach(function(report) {
        var latitude = report.fields.latitude;
        var longitude = report.fields.longitude;
        var disasterType = report.fields.disaster_type;
        var location = report.fields.location;
        
        if (latitude && longitude) {
            // Add marker to the map
            L.marker([latitude, longitude]).addTo(map)
                .bindPopup(`<b>${disasterType}</b><br>${location}`)
                .openPopup();
        } else {
            console.error(`Missing coordinates for location: ${location}`);
        }
    });
</script>

{% endblock %}
